{% extends "mxv/base.html" %}
{% load static %}

{% block title%}Questions{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="{% url 'index' %}">Home</a></li>
    <li class="breadcrumb-item active">Questions</li>
{% endblock %}

{% block content %}
    

<h2>Questions for Candidates</h2>
{% if not is_candidate %}
  <h3>Ask a candidate a question</h3>
  <p class="body-sm-1">You can ask candidates 1 question. There are 6 question topics to choose from. <a href="info">Find out more</a></p>
  {% if not has_question %}
  <a class="btn btn-outline-primary btn-block" href="{% url 'questions:index' %}#ask-a-question">ASK A QUESTION</a>
  {% endif %}
{% endif %}

<!-- IF APPROVED OR PENDING QUESTION -->

{% if pending_question %}
  {% for pending_question in pending_question %}
  <div class="row mb-4">
    <div class="col-sm-12">
    <div class="card">
      <div class="card-body">
        <div class="card-row-body">
          <p class="label-2"><span class="primary">Your question</span> in {{ pending_question.category.title }}</p>
            <p class="mb-0">{{ pending_question.text }}</p>
            <hr class="my-2" />
          </div>
          <div class="card-row-body">
            <span class="badge badge-secondary">This question is pending moderation</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
{% endif %}

<!-- ELSE SHOW MOST RECENT REJECT -->

{% if reject and not pending_question and not has_question %}
    <!-- TODO: SHOW ONLY MOST RECENT -->
    <div class="row">
      <div class="col-sm-12">
        <div class="card">
          <div class="card-body">
            <div class="card-row-body">
              <p class="label-2">Posted by {{ reject.author.name }} in <br>{{ reject.category.title }}
                at
                {{ reject.created_at }} </p>
              <p class="mb-0">{{ reject.text }}</p>
              <hr class="my-2" />
            </div>
            <div class="card-row-body">
              <p><span class="badge badge-secondary">This question was declined in moderation</span></p>
              <p>Reason for rejection: {{ reject.reject_reason }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>
{% endif %}

<!-- DISPLAY QUESTIONS -->
</div>

<!-- select cats -->



<h1>{{ current_category_title }}</h1>

  <div class="container-full grey-backing-strict" style="border-bottom: 1px solid #E5E5E5;">
    <div class="row">
      <div class="col-sm-12 col-lg-6">
        <h2>Questions asked</h2>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-12">
      <form class="form-group" action="{% url 'questions:index' %}" method="POST" id="category_select">
        {% csrf_token %}
        <select id="id_category_select" name="category_select" onchange="this.form.submit()">
          <option disabled selected style="display: none;">
            {% for category in categories %}
            {% if current_category == category.number%}
            {{ category.title }}
            {% endif %}
            {% endfor %}
            {% if current_category == 0 %}
            All topics
            {% endif %}
          </option>
          <option value="0">All topics</option>
          {% for category in categories %}
          <option value="{{ category.number }}">{{ category.title }}</option>
          {% endfor %}
        </select>
      </form>
    </div>
    </div>
  

    {% if num_questions == 0 %}
        <div class="row justify-content-center">
        
          <div class="col-sm-12 col-md-6">
          
            <h3 align="center">No-one's asked a question in this category yet. {% if not has_question %} You can be the first! {% endif %}</h3>

          </div>
        </div>
            {% else %}
    <div class="row">
      {% for question in questions %}
      {% if current_category == question.category.number or current_category == 0 %}
      
      <div class="col-sm-12 col-md-6">
        <div class="card mb-4">
          <div class="card-body">
            <div class="card-row-body">
              <p class="label-2">Posted by {{ question.author.name }} in {{ question.category.title }}</p>

                <h3 class="mb-0"><a href="{% url 'questions:answers' question.pk %}">{{question.text}}</a></h3>
                <hr class="my-2" />
              </div>
              <div class="card-row-body">
              {% include './question_card_status.html' with question=question is_candidate=is_candidate %}
              </div>
            </div>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>
  <!-- <pre> {% filter force_escape %} {% debug %} {% endfilter %} </pre> -->
  <!-- IF NOT CANDIDATE + NO Q, DISPLAY ASK Q -->
  
  {% if not is_candidate %}
{% if not has_question %}
<div class="container">
  <div class="row">
    <div id="#ask-a-question" class="col-sm-12">
    <h2>Ask your question</h2>
    <p>Please do not duplicate existing questions. <a href="info">Read more about question rules and see examples</a></p>

    <form method="post" novalidate>
      {% csrf_token %}
      {% include 'mxv/includes/form.html' %}
      <button type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#submitModal">
        SUBMIT
      </button>
      <div class="modal fade" id="submitModal" tabindex="-1" role="dialog" aria-labelledby="submitModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-body">
            <h2>Please check your question</h2>
            <p>
              To make sure your question is approved, please check that it is:
              <ul>
                <li>New and not repeating a question asked by another member.</li>
                <li>Addressed to all candidates and not targetting or biased towards any individual candidate.</li>
                <li>In line witih Momentumâ€™s code of ethics.</li>
                <li>If not, please go back and edit your question. Once submitted, your question cannot be edited.</li>
              </ul>
            </p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-secondary btn-block" data-dismiss="modal">Go back</button>
              <button type="submit" class="btn btn-outline-primary btn-block">SUBMIT</button>
            </div>
          </div>
        </div>
      </div>

    </form>

{% endif %}
    </div>
  </div>
{% endif %}
  
{% endblock %}